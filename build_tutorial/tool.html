<!-- layout.html -->


<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tools &mdash; AgentScope Doc  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=d2d258e8" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/gallery.css?v=333a68b5" />

  
    
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/language_switch.js?v=6d1ec912"></script>
    <script src="../_static/js/theme.js"></script>
    <script type="text/javascript" src="../_static/language_switch.js"></script>

    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="MCP" href="MCP.html" />
    <link rel="prev" title="Configuring and Monitoring" href="monitor.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
    
    
    <a href="../index.html" 
       class="icon icon-home" >
        AgentScope Doc
    </a>

    <div class="language-switch-container">
        <button class="language-switch-button" onclick="toChinese()">
            中文
        </button>
        |
        <button class="language-switch-button" onclick="toEnglish()">
            EN
        </button>
    </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="message.html">Message</a></li>
<li class="toctree-l1"><a class="reference internal" href="agent.html">Build Agent</a></li>
<li class="toctree-l1"><a class="reference internal" href="conversation.html">Build Conversation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FQA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/faq.html">FQA</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Task Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="model.html">Model APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="prompt.html">Prompt Formatting</a></li>
<li class="toctree-l1"><a class="reference internal" href="structured_output.html">Structured Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="streaming.html">Streaming Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="builtin_agent.html">Built-in Agents</a></li>
<li class="toctree-l1"><a class="reference internal" href="multimodality.html">MultiModality</a></li>
<li class="toctree-l1"><a class="reference internal" href="visual.html">Visual Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="monitor.html">Configuring and Monitoring</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#background">Background</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-built-in-tools">Using Built-in Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prompt-based-tool-calling">Prompt-based Tool Calling</a></li>
<li class="toctree-l2"><a class="reference internal" href="#api-based-tool-calling">API-based Tool Calling</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-mcp-with-servicetoolkit">Using MCP with ServiceToolkit</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-custom-tools">Creating Custom Tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="MCP.html">MCP</a></li>
<li class="toctree-l1"><a class="reference internal" href="rag.html">Retrieval Augmentation Generation (RAG)</a></li>
<li class="toctree-l1"><a class="reference internal" href="hook.html">Hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="distribution.html">Distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="prompt_optimization.html">System Prompt Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="web_browser.html">Web Browser Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="low_code.html">Low-code Development</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Applications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/swe.html">SWE-Bench</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../build_api/agentscope.html">agentscope</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build_api/agentscope.message.html">agentscope.message</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build_api/agentscope.models.html">agentscope.models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build_api/agentscope.agents.html">agentscope.agents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build_api/agentscope.memory.html">agentscope.memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build_api/agentscope.parsers.html">agentscope.parsers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build_api/agentscope.rag.html">agentscope.rag</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build_api/agentscope.service.html">agentscope.service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build_api/agentscope.prompt.html">agentscope.prompt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build_api/agentscope.tokens.html">agentscope.tokens</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build_api/agentscope.exception.html">agentscope.exception</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AgentScope Doc</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Tools</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/build_tutorial/tool.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-build-tutorial-tool-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code.</p>
</div>
<section class="sphx-glr-example-title" id="tools">
<span id="sphx-glr-build-tutorial-tool-py"></span><span id="id1"></span><h1>Tools<a class="headerlink" href="#tools" title="Link to this heading"></a></h1>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Link to this heading"></a></h2>
<p>There are two ways to call tools in LLM-empowered multi-agent applications.</p>
<a class="reference internal image-reference" href="https://img.alicdn.com/imgextra/i3/O1CN01iizvjY1UjKCE3q5FR_!!6000000002553-0-tps-1830-792.jpg"><img alt="Two ways for tool calling" class="align-center" src="https://img.alicdn.com/imgextra/i3/O1CN01iizvjY1UjKCE3q5FR_!!6000000002553-0-tps-1830-792.jpg" style="width: 80%;" />
</a>
<ul class="simple">
<li><p>Prompt-based tool calling: Developers introduce tools in the prompt and extract tool calls from the LLM response.</p></li>
<li><p>API-based tool calling: Developers provide tools description in JSON schema format. The LLM API will directly return the tool calls in their specific format.</p></li>
</ul>
<p>AgentScope supports both ways. In this tutorial, we will introduce how to use
the built-in tools and how to create custom tools.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">agentscope</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentscope.message</span><span class="w"> </span><span class="kn">import</span> <span class="n">Msg</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentscope.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">DashScopeChatWrapper</span>
</pre></div>
</div>
</section>
<section id="using-built-in-tools">
<h2>Using Built-in Tools<a class="headerlink" href="#using-built-in-tools" title="Link to this heading"></a></h2>
<p>AgentScope provides a <cite>ServiceToolkit</cite> module that supports to</p>
<ul class="simple">
<li><p>parse tools into JSON schemas automatically</p></li>
<li><p>check arguments and call functions</p></li>
</ul>
<p>Before using <cite>ServiceToolkit</cite>, we can take a look at the available tools in
the <cite>agentscope.service</cite> module.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">agentscope.service</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_help</span><span class="p">,</span> <span class="n">ServiceResponse</span><span class="p">,</span> <span class="n">ServiceExecStatus</span>

<span class="n">get_help</span><span class="p">()</span>
</pre></div>
</div>
<p>All above functions are implemented as Python functions.
They can be registered to the <cite>ServiceToolkit</cite> by calling the <cite>add</cite> method.
The <cite>ServiceToolkit</cite> will parse the tool functions into JSON schema
automatically.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">agentscope.service</span><span class="w"> </span><span class="kn">import</span> <span class="n">ServiceToolkit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentscope.service</span><span class="w"> </span><span class="kn">import</span> <span class="n">bing_search</span><span class="p">,</span> <span class="n">execute_shell_command</span>

<span class="n">toolkit</span> <span class="o">=</span> <span class="n">ServiceToolkit</span><span class="p">()</span>
<span class="n">toolkit</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">execute_shell_command</span><span class="p">)</span>
</pre></div>
</div>
<p>Note some parameters of the tool functions (e.g. api_key) should be handled
by developers.
You can directly pass these parameters as keyword arguments in the add
method as follows, the reserved parameters will be left to the agent to fill.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">toolkit</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">bing_search</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="s2">&quot;xxx&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The tools instruction:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">toolkit</span><span class="o">.</span><span class="n">tools_instruction</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>The tools instruction:
## Tool Functions:
The following tool functions are available in the format of
```
{index}. {function name}: {function description}
{argument1 name} ({argument type}): {argument description}
{argument2 name} ({argument type}): {argument description}
...
```

1. execute_shell_command: Executes a given shell command.
        command (string): The shell command to execute.
2. bing_search: Search question in Bing Search API and return the searching results
        num_results (number): The number of search results to return.
        question (string): The search query string.
</pre></div>
</div>
<p>The built-in default calling format:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">toolkit</span><span class="o">.</span><span class="n">tools_calling_format</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[{&quot;name&quot;: &quot;{function name}&quot;, &quot;arguments&quot;: {&quot;{argument1 name}&quot;: xxx, &quot;{argument2 name}&quot;: xxx}}]
</pre></div>
</div>
<p>The JSON Schema description of the tool functions:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">toolkit</span><span class="o">.</span><span class="n">json_schemas</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>{
  &quot;execute_shell_command&quot;: {
    &quot;type&quot;: &quot;function&quot;,
    &quot;function&quot;: {
      &quot;name&quot;: &quot;execute_shell_command&quot;,
      &quot;description&quot;: &quot;Executes a given shell command.&quot;,
      &quot;parameters&quot;: {
        &quot;type&quot;: &quot;object&quot;,
        &quot;properties&quot;: {
          &quot;command&quot;: {
            &quot;type&quot;: &quot;string&quot;,
            &quot;description&quot;: &quot;The shell command to execute.&quot;
          }
        },
        &quot;required&quot;: [
          &quot;command&quot;
        ]
      }
    }
  },
  &quot;bing_search&quot;: {
    &quot;type&quot;: &quot;function&quot;,
    &quot;function&quot;: {
      &quot;name&quot;: &quot;bing_search&quot;,
      &quot;description&quot;: &quot;Search question in Bing Search API and return the searching results&quot;,
      &quot;parameters&quot;: {
        &quot;type&quot;: &quot;object&quot;,
        &quot;properties&quot;: {
          &quot;num_results&quot;: {
            &quot;type&quot;: &quot;number&quot;,
            &quot;description&quot;: &quot;The number of search results to return.&quot;,
            &quot;default&quot;: 10
          },
          &quot;question&quot;: {
            &quot;type&quot;: &quot;string&quot;,
            &quot;description&quot;: &quot;The search query string.&quot;
          }
        },
        &quot;required&quot;: [
          &quot;question&quot;
        ]
      }
    }
  }
}
</pre></div>
</div>
</section>
<section id="prompt-based-tool-calling">
<h2>Prompt-based Tool Calling<a class="headerlink" href="#prompt-based-tool-calling" title="Link to this heading"></a></h2>
<p>In prompt-based tool calling, developers need to
- introduce the tools and call format in prompt
- parse and extract the tool calls from the LLM response.</p>
<p>You can use the parsers in <a class="reference internal" href="structured_output.html#structured-output"><span class="std std-ref">Structured Output</span></a> section to parse the LLM
response and extract the tool calls.
The tool call format of <cite>ServiceToolkit</cite> is as follows:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">agentscope.message</span><span class="w"> </span><span class="kn">import</span> <span class="n">ToolUseBlock</span>

<span class="n">tool_call</span> <span class="o">=</span> <span class="n">ToolUseBlock</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;tool_use&quot;</span><span class="p">,</span>
    <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;xxx&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;bing_search&quot;</span><span class="p">,</span>
    <span class="nb">input</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="s2">&quot;AgentScope&quot;</span><span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
<p>After assembling the <cite>ServiceToolkit</cite>, you can integrate it into agent.</p>
<p>In AgentScope, we provide a <cite>ReActAgent</cite> to handle the tool usage, you can
directly pass the <cite>ServiceToolkit</cite> object into this agent.
Refer to <span class="xref std std-ref">builtin-agent</span> for implementation details of this agent.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><cite>ReActAgent</cite> constructs the prompt and parses the tools locally,
rather than through the tools API provided by the model API. For using the
tools API, please refer to <span class="xref std std-ref">tools-api</span>.</p>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">agentscope.agents</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReActAgent</span>

<span class="n">agentscope</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
    <span class="n">model_configs</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;config_name&quot;</span><span class="p">:</span> <span class="s2">&quot;my-qwen-max&quot;</span><span class="p">,</span>
        <span class="s2">&quot;model_type&quot;</span><span class="p">:</span> <span class="s2">&quot;dashscope_chat&quot;</span><span class="p">,</span>
        <span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="s2">&quot;qwen-max&quot;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="n">agent</span> <span class="o">=</span> <span class="n">ReActAgent</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Friday&quot;</span><span class="p">,</span>
    <span class="n">model_config_name</span><span class="o">=</span><span class="s2">&quot;my-qwen-max&quot;</span><span class="p">,</span>
    <span class="n">service_toolkit</span><span class="o">=</span><span class="n">toolkit</span><span class="p">,</span>
    <span class="n">sys_prompt</span><span class="o">=</span><span class="s2">&quot;You&#39;re a helpful assistant named Friday.&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">msg_task</span> <span class="o">=</span> <span class="n">Msg</span><span class="p">(</span>
    <span class="s2">&quot;user&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Help me to calculate 1615114134*4343434343&quot;</span><span class="p">,</span>
    <span class="s2">&quot;user&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">agent</span><span class="p">(</span><span class="n">msg_task</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>system: Respond with specific tags as outlined below:
&lt;thought&gt;{what you thought}&lt;/thought&gt;
&lt;function&gt;{the function name you want to call}&lt;/function&gt;
&lt;{argument name}&gt;{argument value}&lt;/{argument name}&gt;
&lt;{argument name}&gt;{argument value}&lt;/{argument name}&gt;
...
Friday: &lt;thought&gt;To calculate the multiplication of two large numbers, I don&#39;t need to use any tool functions as I can perform the calculation directly.&lt;/thought&gt;
&lt;function&gt;finish&lt;/function&gt;
&lt;response&gt;The result of 1615114134 multiplied by 4343434343 is 7008499445527494622.&lt;/response&gt;
system: 1. Execute function finish
   [ARGUMENTS]:
       {&quot;response&quot;: &quot;The result of 1615114134 multiplied by 4343434343 is 7008499445527494622.&quot;}
   [RESULT]: The result of 1615114134 multiplied by 4343434343 is 7008499445527494622.
</pre></div>
</div>
</section>
<section id="api-based-tool-calling">
<h2>API-based Tool Calling<a class="headerlink" href="#api-based-tool-calling" title="Link to this heading"></a></h2>
<p>In API-based tool calling, developers only need to prepare the tools
description in JSON schema format. However, different APIs differ in
- the format of the tool description, and
- how to construct the prompt with tool calls and execution results.</p>
<a class="reference internal image-reference" href="https://img.alicdn.com/imgextra/i4/O1CN01HIHrnw21LrDxzrB4a_!!6000000006969-0-tps-1920-1080.jpg"><img alt="API-based tool calling" class="align-center" src="https://img.alicdn.com/imgextra/i4/O1CN01HIHrnw21LrDxzrB4a_!!6000000006969-0-tps-1920-1080.jpg" style="width: 100%;" />
</a>
<p>The above figure takes OpenAI as an example to show how API-based tool
calling works in AgentScope. We block API-specific requirements by
<cite>agentscope.formatter</cite> and <cite>ModelResponse</cite> modules. All developers need to
know is</p>
<ol class="arabic simple">
<li><p><cite>ServiceToolkit</cite> will parse the tool functions into standard JSON schema automatically</p></li>
<li><p><cite>Formatter</cite> class will transform the JSON schemas and messages into the required format</p></li>
<li><p>The tool calls are all unified into the same format (<cite>ToolUseBlock</cite>) within <cite>ModelResponse</cite></p></li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>A new agent class <cite>ReActAgentV2</cite> is added for API-based tools calling!</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Currently, only the <cite>format_chat</cite> method supports tools API. The
<cite>format_multi_agent</cite> method will be supported in the future.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>API-based tool calling does not support streaming return yet, and
the related functionality is under development.</p>
</div>
<p>Here we take DashScope as an example to show how to use the tools API.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">agentscope.formatters</span><span class="w"> </span><span class="kn">import</span> <span class="n">DashScopeFormatter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentscope.message</span><span class="w"> </span><span class="kn">import</span> <span class="n">TextBlock</span><span class="p">,</span> <span class="n">ToolUseBlock</span><span class="p">,</span> <span class="n">ToolResultBlock</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">DashScopeChatWrapper</span><span class="p">(</span>
    <span class="n">config_name</span><span class="o">=</span><span class="s2">&quot;_&quot;</span><span class="p">,</span>
    <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;qwen-max&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Step 3 -&gt; 4 in the figure, formating messages and JSON schemas:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">msgs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">Msg</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;Help me to execute shell cmd &#39;whoami&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;user&quot;</span><span class="p">),</span>
<span class="p">]</span>

<span class="n">formatted_msgs</span> <span class="o">=</span> <span class="n">DashScopeFormatter</span><span class="o">.</span><span class="n">format_chat</span><span class="p">(</span><span class="n">msgs</span><span class="p">)</span>
<span class="n">formatted_schemas</span> <span class="o">=</span> <span class="n">DashScopeFormatter</span><span class="o">.</span><span class="n">format_tools_json_schemas</span><span class="p">(</span>
    <span class="n">toolkit</span><span class="o">.</span><span class="n">json_schemas</span><span class="p">,</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">formatted_msgs</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[
    {
        &quot;role&quot;: &quot;user&quot;,
        &quot;content&quot;: [
            {
                &quot;text&quot;: &quot;Help me to execute shell cmd &#39;whoami&#39;&quot;
            }
        ]
    }
]
</pre></div>
</div>
<p>Step 5 -&gt; 6 -&gt; 7 in the figure, getting the model response:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">formatted_msgs</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="n">formatted_schemas</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;tool_calls:&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">tool_calls</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>tool_calls: [
    {
        &quot;type&quot;: &quot;tool_use&quot;,
        &quot;id&quot;: &quot;call_ecd14fe9464d47a4858c1d&quot;,
        &quot;name&quot;: &quot;execute_shell_command&quot;,
        &quot;input&quot;: {
            &quot;command&quot;: &quot;whoami&quot;
        }
    }
]
</pre></div>
</div>
<p>Step 8, creating a new message with the tool calls:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a new msg with the tool calls</span>
<span class="n">content</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
    <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TextBlock</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
<span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">tool_calls</span><span class="p">:</span>
    <span class="n">content</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">tool_calls</span><span class="p">)</span>
<span class="n">msgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Msg</span><span class="p">(</span><span class="s2">&quot;assistant&quot;</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="c1"># execute the tool calls</span>
<span class="n">msg_execution</span> <span class="o">=</span> <span class="n">toolkit</span><span class="o">.</span><span class="n">parse_and_call_func</span><span class="p">(</span>
    <span class="n">response</span><span class="o">.</span><span class="n">tool_calls</span><span class="p">,</span>
    <span class="n">tools_api_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Must be ture for tools API</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>assistant: [
    {
        &quot;type&quot;: &quot;tool_use&quot;,
        &quot;id&quot;: &quot;call_ecd14fe9464d47a4858c1d&quot;,
        &quot;name&quot;: &quot;execute_shell_command&quot;,
        &quot;input&quot;: {
            &quot;command&quot;: &quot;whoami&quot;
        }
    }
]
</pre></div>
</div>
<p>Step 9, adding the execution results to the message list:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">msgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg_execution</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, let’s try to format the new message list with tool calls and result
again!</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">formatted_msgs</span> <span class="o">=</span> <span class="n">DashScopeFormatter</span><span class="o">.</span><span class="n">format_chat</span><span class="p">(</span><span class="n">msgs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">formatted_msgs</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[
    {
        &quot;role&quot;: &quot;user&quot;,
        &quot;content&quot;: [
            {
                &quot;text&quot;: &quot;Help me to execute shell cmd &#39;whoami&#39;&quot;
            }
        ]
    },
    {
        &quot;role&quot;: &quot;assistant&quot;,
        &quot;content&quot;: null,
        &quot;tool_calls&quot;: [
            {
                &quot;id&quot;: &quot;call_ecd14fe9464d47a4858c1d&quot;,
                &quot;type&quot;: &quot;function&quot;,
                &quot;function&quot;: {
                    &quot;name&quot;: &quot;execute_shell_command&quot;,
                    &quot;arguments&quot;: &quot;{\&quot;command\&quot;: \&quot;whoami\&quot;}&quot;
                }
            }
        ]
    },
    {
        &quot;role&quot;: &quot;tool&quot;,
        &quot;tool_call_id&quot;: &quot;call_ecd14fe9464d47a4858c1d&quot;,
        &quot;content&quot;: &quot;runner&quot;,
        &quot;name&quot;: &quot;execute_shell_command&quot;
    }
]
</pre></div>
</div>
<p>Up to now, we have already finished the API-based tool calling process.
The whole process refers to the implementation of
<cite>agentscope.agents.ReActAgentV2</cite> class. You can also directly use this
agent.</p>
</section>
<section id="using-mcp-with-servicetoolkit">
<h2>Using MCP with ServiceToolkit<a class="headerlink" href="#using-mcp-with-servicetoolkit" title="Link to this heading"></a></h2>
<p>AgentScope provides support for integrating MCP (Model Context Protocol)
servers, enabling enhanced capabilities for models and tools. You can add
MCP servers to the <cite>ServiceToolkit</cite> using the <cite>add_mcp_servers</cite> method,
where you specify the configurations for each server.
Please note that MCP requires Python version &gt;= 3.10.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">configs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;mcpServers&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;puppeteer&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;npx&quot;</span><span class="p">,</span>
            <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;-y&quot;</span><span class="p">,</span> <span class="s2">&quot;@modelcontextprotocol/server-puppeteer&quot;</span><span class="p">],</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Add MCP server configurations to the ServiceToolkit
<cite>toolkit.add_mcp_servers(server_configs=configs)</cite></p>
</section>
<section id="creating-custom-tools">
<h2>Creating Custom Tools<a class="headerlink" href="#creating-custom-tools" title="Link to this heading"></a></h2>
<p>A custom tool function must follow these rules:</p>
<ul class="simple">
<li><p>Typing for arguments</p></li>
<li><p>Well-written docstring in Google style</p></li>
<li><p>The return of the function must be wrapped by <cite>ServiceResponse</cite></p></li>
</ul>
<p>After calling the <cite>toolkit.add</cite> function, the tool function will be parsed
automatically and registered to the <cite>ServiceToolkit</cite>.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">new_function</span><span class="p">(</span><span class="n">arg1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">arg2</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ServiceResponse</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A brief introduction of this function in one line.</span>

<span class="sd">    Args:</span>
<span class="sd">        arg1 (`str`):</span>
<span class="sd">            Brief description of arg1</span>
<span class="sd">        arg2 (`int`):</span>
<span class="sd">            Brief description of arg2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ServiceResponse</span><span class="p">(</span>
        <span class="n">status</span><span class="o">=</span><span class="n">ServiceExecStatus</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">,</span>
        <span class="n">content</span><span class="o">=</span><span class="s2">&quot;Done!&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 10.166 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-build-tutorial-tool-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/9682e4a38fd7e8b6971e1afe68e967ff/tool.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">tool.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/ede26fc984fd5f12a4ede3580d57b877/tool.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">tool.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-zip docutils container">
<p><a class="reference download internal" download="" href="../_downloads/6456442ff90fd4cee044c2493d6e351b/tool.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">zipped:</span> <span class="pre">tool.zip</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="monitor.html" class="btn btn-neutral float-left" title="Configuring and Monitoring" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="MCP.html" class="btn btn-neutral float-right" title="MCP" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Alibaba.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>